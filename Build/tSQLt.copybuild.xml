<?xml version="1.0"?>
<project name="tSQLt" default="all" basedir=".">

 <target name="all" depends="clean.and.init, hello, copy" />

 <target name="clean.and.init" description="delete directories">
  <delete dir="./temp/Build_Debug/"/>
  <mkdir dir="./temp/Build_Debug/" />

  <copy todir="./temp/Build_Debug/">
   <fileset dir="../Build_Debug">
    <include name=".gitignore" />
    <include name="Build_Debug.ssmssqlproj" />
   </fileset>
  </copy>

  <delete dir="../Build_Debug"/>
  <mkdir dir="../Build_Debug" />

  <copy todir="../Build_Debug">
   <fileset dir="./temp/Build_Debug">
    <include name=".gitignore" />
    <include name="Build_Debug.ssmssqlproj" />
   </fileset>
  </copy>

 </target> 

 <target name="hello" description="announcement">
  <loadfile srcFile="output/tSQLtBuild/Version.txt" property="clr.version" failonerror="true">
   <filterchain>
    <striplinebreaks />
    <tokenfilter>
     <deletecharacters chars="\t" />
     <trim />
     <ignoreblank />
    </tokenfilter>
   </filterchain>
  </loadfile>

  <echo message="Copying tSQLt build files to local Build_Debug. (Version:${clr.version})" />
 </target>

 <target name="copy" description="prepare directories for tSQLt build">

  <copy todir="../Build_Debug" flatten="true">
   <fileset dir="output">
    <include name="tSQLt/tSQLt.zip" />
    <include name="tSQLtBuild/tSQLt.tests.zip" />
    <include name="tSQLtBuild/tSQLtSnippets(SQLPrompt).zip" />
    <include name="tSQLtBuild/Version.txt" />
    <include name="tSQLtBuild/ReadMe.txt" />
   </fileset>
  </copy>

  <unzip src="../Build_Debug/tSQLt.zip" dest="../Build_Debug" />
  <unzip src="../Build_Debug/tSQLt.tests.zip" dest="../Build_Debug" />
 </target>

</project>
