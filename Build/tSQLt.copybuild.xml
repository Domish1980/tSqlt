<?xml version="1.0"?>
<project name="tSQLt" default="all" basedir=".">

 <target name="all" depends="clean, hello, init, copy" />

 <target name="clean" description="delete directories">
  <delete dir="../Build_Artifact"/>
 </target> 

 <target name="init" description="create directories">
    <mkdir dir="../Build_Artifact" />
 </target> 

 <target name="hello" description="announcement">
  <loadfile srcFile="output/tSQLtBuild/Version.txt" property="clr.version" failonerror="true">
   <filterchain>
    <striplinebreaks />
    <tokenfilter>
     <deletecharacters chars="\t" />
     <trim />
     <ignoreblank />
    </tokenfilter>
   </filterchain>
  </loadfile>

  <echo message="Copying tSQLt build files to local Build_Artifact. (Version:${clr.version})" />
 </target>

 <target name="copy" description="prepare directories for tSQLt build">

  <copy todir="../Build_Artifact" flatten="true">
   <fileset dir="output">
    <include name="tSQLt/tSQLt.zip" />
    <include name="tSQLtBuild/tSQLt.tests.zip" />
    <include name="tSQLtBuild/tSQLtSnippets(SQLPrompt).zip" />
    <include name="tSQLtBuild/Version.txt" />
    <include name="tSQLtBuild/ReadMe.txt" />
   </fileset>
  </copy>

  <unzip src="../Build_Artifact/tSQLt.zip" dest="../Build_Artifact" />
  <unzip src="../Build_Artifact/tSQLt.tests.zip" dest="../Build_Artifact" />
 </target>

</project>
